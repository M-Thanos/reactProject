# نظام المصادقة والأدوار 🔐

## ✅ تم الإضافة بنجاح

تم إضافة نظام مصادقة كامل مع ثلاثة أدوار: **مدير، مصمم، مستخدم**

---

## 🚀 البدء السريع

### 1️⃣ إنشاء المستخدمين

**الطريقة الأسهل:**
1. شغل المشروع: `npm run dev`
2. افتح: http://localhost:5173/setup
3. اضغط زر "إنشاء المستخدمين"
4. انتظر حتى تظهر رسالة النجاح

**الطريقة اليدوية:**
- افتح Firebase Console
- أضف المستخدمين في Authentication
- أضف بياناتهم في Firestore collection "users"

### 2️⃣ نشر قواعد Firestore

```bash
firebase deploy --only firestore:rules
```

### 3️⃣ تجربة النظام

| الدور | البريد | كلمة المرور |
|------|--------|-------------|
| **مدير** | admin@example.com | admin123 |
| **مصمم** | designer@example.com | designer123 |
| **مستخدم** | user@example.com | user123 |

---

## 🎭 الأدوار والصلاحيات

### 👑 مدير (Admin)
- **كل الصلاحيات**
- إدارة المستخدمين
- تغيير الأدوار
- الوصول لجميع الصفحات

### 🎨 مصمم (Designer)
- إدارة المحتوى والأزرار
- الوصول لقائمة المسوقين
- **لا يمكنه** إدارة المستخدمين

### 👤 مستخدم عادي (User)
- عرض المحتوى فقط
- **لا يمكنه** التعديل
- **لا يمكنه** الوصول للصفحات الإدارية

---

## 📍 المسارات

### متاح للجميع:
- `/login` - تسجيل الدخول
- `/setup` - إعداد المستخدمين (احذفه بعد الاستخدام!)

### يتطلب تسجيل دخول:
- `/` - الصفحة الرئيسية (الكل)
- `/client` - صفحة العميل (الكل)

### مدير ومصمم فقط:
- `/marketers-list` - قائمة المسوقين

### مدير فقط:
- `/users` - إدارة المستخدمين

---

## 🗂️ الملفات المضافة

```
src/
├── contexts/
│   └── AuthContext.tsx              ✅ إدارة المصادقة
├── components/
│   └── ProtectedRoute.tsx           ✅ حماية المسارات
├── pages/
│   ├── Auth/
│   │   ├── Login.tsx               ✅ تسجيل الدخول
│   │   └── UserManagement.tsx      ✅ إدارة المستخدمين
│   └── Setup/
│       └── InitialSetup.tsx        ⚠️ احذفه بعد الاستخدام
└── utils/
    └── createInitialUsers.ts       ⚠️ احذفه بعد الاستخدام

firestore.rules                      ✅ قواعد الأمان
```

---

## 🔥 خطوات مهمة بعد الإعداد

### ✅ أولاً: التأكد من عمل النظام
1. جرب تسجيل دخول بحساب المدير
2. اذهب لصفحة `/users` للتأكد من الصلاحيات
3. سجل خروج وجرب حساب المصمم والمستخدم

### 🗑️ ثانياً: حذف الملفات المؤقتة
بعد التأكد من عمل النظام، احذف:

```bash
# حذف ملفات الإعداد
rm src/pages/Setup/InitialSetup.tsx
rm src/utils/createInitialUsers.ts
rm -rf src/pages/Setup/
```

ثم في `src/App.tsx` احذف هذه الأسطر:
```tsx
import InitialSetup from './pages/Setup/InitialSetup';
<Route path="/setup" element={<InitialSetup />} />
```

### 🔒 ثالثاً: تأمين النظام
1. **غير كلمات المرور:**
   - افتح Firebase Console
   - Authentication > Users
   - اختر المستخدم > Reset password

2. **فعل المصادقة الثنائية (2FA):**
   - افتح Firebase Console
   - Project Settings > Users and permissions
   - فعل 2FA للمدراء

---

## 💡 نصائح مهمة

### ✅ افعل:
- ✅ غير كلمات المرور الافتراضية فوراً
- ✅ احذف صفحة Setup بعد الاستخدام
- ✅ انشر Firestore Rules قبل الاستخدام
- ✅ اختبر جميع الأدوار

### ❌ لا تفعل:
- ❌ تترك صفحة /setup متاحة
- ❌ تشارك كلمات مرور المدير
- ❌ تنسى نشر Firestore Rules
- ❌ تستخدم كلمات المرور الافتراضية في الإنتاج

---

## 🔍 استخدام النظام في الكود

### في المكونات:
```tsx
import { useAuth } from '../contexts/AuthContext';

function MyComponent() {
  const { userData, hasRole, logout } = useAuth();

  // عرض معلومات المستخدم
  console.log(userData?.email);
  console.log(userData?.role);

  // التحقق من الدور
  if (hasRole('admin')) {
    return <AdminPanel />;
  }

  // تسجيل الخروج
  const handleLogout = async () => {
    await logout();
  };
}
```

### حماية مسار:
```tsx
<Route 
  path="/my-page" 
  element={
    <ProtectedRoute allowedRoles={['admin', 'designer']}>
      <MyPage />
    </ProtectedRoute>
  } 
/>
```

---

## ❓ حل المشاكل الشائعة

### المشكلة: لا أستطيع تسجيل الدخول
**الحل:**
1. تأكد من إنشاء المستخدم في Firebase Authentication
2. تأكد من وجود document في Firestore collection "users"
3. تحقق من صحة البريد وكلمة المرور

### المشكلة: "غير مصرح لك بالوصول"
**الحل:**
1. تأكد من أن الدور صحيح في Firestore
2. تحقق من صلاحيات المسار في App.tsx

### المشكلة: "Permission denied" في Firestore
**الحل:**
```bash
firebase deploy --only firestore:rules
```

### المشكلة: صفحة Setup لا تعمل
**الحل:**
1. تحقق من Console المتصفح (F12)
2. تأكد من اتصالك بالإنترنت
3. تأكد من إعدادات Firebase

---

## 📚 ملفات المساعدة

| الملف | الوصف |
|------|-------|
| `QUICK_START_AUTH.md` | دليل البدء السريع (تفصيلي) |
| `AUTHENTICATION_GUIDE.md` | دليل شامل للنظام |
| `AUTHENTICATION_SUMMARY.md` | ملخص تقني كامل |
| `نظام_المصادقة.md` | هذا الملف (نسخة عربية مختصرة) |

---

## 🎯 الخطوات التالية (اختياري)

يمكنك إضافة:
- [ ] صفحة استعادة كلمة المرور
- [ ] تسجيل دخول بـGoogle
- [ ] صفحة الملف الشخصي
- [ ] تغيير كلمة المرور
- [ ] إشعارات بالبريد الإلكتروني
- [ ] سجل النشاطات (Activity Log)

---

## ✨ تم بنجاح!

نظام المصادقة جاهز للاستخدام. استمتع! 🎉

**للمساعدة:** راجع الملفات المذكورة أعلاه أو افتح issue على GitHub

