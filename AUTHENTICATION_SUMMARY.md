# ููุฎุต ูุธุงู ุงููุตุงุฏูุฉ ูุงูุฃุฏูุงุฑ โ

## โจ ูุง ุชู ุฅุถุงูุชู

ุชู ุฅุถุงูุฉ ูุธุงู ูุตุงุฏูุฉ ูุฃุฏูุงุฑ ูุงูู ููุชุทุจูู ุจุงุณุชุฎุฏุงู Firebase Authentication ู Firestore.

---

## ๐ฆ ุงููููุงุช ุงููุถุงูุฉ

### 1. Context ูุงููุตุงุฏูุฉ
```
src/contexts/AuthContext.tsx
```
- Context ูุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุตุงุฏูุฉ
- ุฏูุงู ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ
- ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ
- ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงููุณุชุฎุฏู

### 2. ุตูุญุงุช ุงููุตุงุฏูุฉ
```
src/pages/Auth/
โโโ Login.tsx              # ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
โโโ UserManagement.tsx     # ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (Admin ููุท)
```

### 3. ุญูุงูุฉ ุงููุณุงุฑุงุช
```
src/components/ProtectedRoute.tsx
```
- ุญูุงูุฉ ุงููุณุงุฑุงุช ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ
- ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ
- ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชููุงุฆู

### 4. ุฃุฏูุงุช ุงูุฅุนุฏุงุฏ
```
src/pages/Setup/InitialSetup.tsx    # ุตูุญุฉ ุฅุนุฏุงุฏ ุงููุณุชุฎุฏููู (ุญุฐููุง ุจุนุฏ ุงูุงุณุชุฎุฏุงู)
src/utils/createInitialUsers.ts     # ุฏูุงู ุฅูุดุงุก ุงููุณุชุฎุฏููู (ุญุฐููุง ุจุนุฏ ุงูุงุณุชุฎุฏุงู)
```

### 5. ุงููุซุงุฆู
```
AUTHENTICATION_GUIDE.md       # ุฏููู ุดุงูู ูููุธุงู
QUICK_START_AUTH.md          # ุฏููู ุงูุจุฏุก ุงูุณุฑูุน
AUTHENTICATION_SUMMARY.md    # ูุฐุง ุงูููู
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. App.tsx
```tsx
// ุชู ุฅุถุงูุฉ:
- ุงุณุชูุฑุงุฏ AuthProvider ู useAuth
- ุญูุงูุฉ ุฌููุน ุงููุณุงุฑุงุช ุจู ProtectedRoute
- ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- route ูููSetup (ุงุญุฐูู ูุงุญูุงู)
- ุชุญุฏูุฏ ุงูุตูุงุญูุงุช ููู ูุณุงุฑ
```

### 2. main.tsx
```tsx
// ุชู ุฅุถุงูุฉ:
- AuthProvider wrapper
- Toaster ููุฅุดุนุงุฑุงุช
```

### 3. src/components/Header/DropdownUser.tsx
```tsx
// ุชู ุชุญุฏูุซ:
- ุนุฑุถ ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุญููููุฉ
- ุนุฑุถ ุงูุฏูุฑ ุจุงูุนุฑุจู
- ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ ูุนูู
- ุฑุงุจุท ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (Admin ููุท)
```

### 4. firestore.rules
```
// ุชู ุฅุถุงูุฉ:
- ููุงุนุฏ ุฃูุงู ูุงููุฉ
- ุฏูุงู ููุชุญูู ูู ุงูุฃุฏูุงุฑ
- ุตูุงุญูุงุช ุญุณุจ ุงูุฏูุฑ ููู collection
- ุญูุงูุฉ collection users
```

---

## ๐ฏ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช

### Admin (ูุฏูุฑ) โญ
| ุงูุตูุญุฉ/ุงููุธููุฉ | ุงูุตูุงุญูุฉ |
|----------------|----------|
| / (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ) | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /client | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /marketers-list | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /users | โ ูุฑุงุกุฉ ููุชุงุจุฉ (ุญุตุฑูุงู) |
| ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู | โ ูุงูู |
| ุชุบููุฑ ุงูุฃุฏูุงุฑ | โ ูุนู |
| ุญุฐู ุงููุณุชุฎุฏููู | โ ูุนู |

### Designer (ูุตูู) ๐จ
| ุงูุตูุญุฉ/ุงููุธููุฉ | ุงูุตูุงุญูุฉ |
|----------------|----------|
| / (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ) | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /client | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /marketers-list | โ ูุฑุงุกุฉ ููุชุงุจุฉ |
| /users | โ ููููุน |
| ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู | โ ููููุน |
| ุชุบููุฑ ุงูุฃุฏูุงุฑ | โ ููููุน |
| ุญุฐู ุงููุณุชุฎุฏููู | โ ููููุน |

### User (ูุณุชุฎุฏู) ๐ค
| ุงูุตูุญุฉ/ุงููุธููุฉ | ุงูุตูุงุญูุฉ |
|----------------|----------|
| / (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ) | โ ูุฑุงุกุฉ ููุท |
| /client | โ ูุฑุงุกุฉ ููุท |
| /marketers-list | โ ููููุน |
| /users | โ ููููุน |
| ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู | โ ููููุน |
| ุชุบููุฑ ุงูุฃุฏูุงุฑ | โ ููููุน |
| ุญุฐู ุงููุณุชุฎุฏููู | โ ููููุน |

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุงููุณุชุฎุฏููู

#### ุงูุทุฑููุฉ ุงูุณููุฉ (ุงุณุชุฎุฏุงู Setup Page):
1. ุดุบู ุงููุดุฑูุน: `npm run dev`
2. ุงุฐูุจ ุฅูู: `http://localhost:5173/setup`
3. ุงุถุบุท "ุฅูุดุงุก ุงููุณุชุฎุฏููู"
4. **ุงุญุฐู ุตูุญุฉ Setup ุจุนุฏ ุงูุงูุชูุงุก**

#### ุงูุทุฑููุฉ ุงููุฏููุฉ (Firebase Console):
1. ุงูุชุญ Firebase Console
2. ุฃุถู ุงููุณุชุฎุฏููู ูู Authentication
3. ุฃูุดุฆ documents ูู Firestore `users` collection

### ุงูุฎุทูุฉ 2: ูุดุฑ Firestore Rules
```bash
firebase deploy --only firestore:rules
```

### ุงูุฎุทูุฉ 3: ุชุฌุฑุจุฉ ุงููุธุงู
```
Admin:    admin@example.com / admin123
Designer: designer@example.com / designer123
User:     user@example.com / user123
```

---

## ๐ ุงูุชุฎุตูุต

### ุฅุถุงูุฉ ุฏูุฑ ุฌุฏูุฏ:

1. **ูู AuthContext.tsx:**
```tsx
export type UserRole = 'admin' | 'user' | 'designer' | 'newRole';
```

2. **ูู firestore.rules:**
```javascript
function isNewRole() {
  return isSignedIn() && getUserRole() == 'newRole';
}
```

3. **ุญูุงูุฉ ูุณุงุฑ ุฌุฏูุฏ:**
```tsx
<ProtectedRoute allowedRoles={['admin', 'newRole']}>
  <MyNewPage />
</ProtectedRoute>
```

### ุชุนุฏูู ุตูุงุญูุงุช:

**ูู App.tsx:**
```tsx
// ุชุบููุฑ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ
<Route 
  path="/marketers-list" 
  element={
    <ProtectedRoute allowedRoles={['admin', 'designer', 'user']}>
      <MarketersListPage />
    </ProtectedRoute>
  } 
/>
```

**ูู firestore.rules:**
```javascript
// ุชุบููุฑ ุตูุงุญูุงุช collection ูุนูู
match /buttons/{buttonId} {
  allow read: if isSignedIn();
  allow write: if isAdmin(); // ูุงู: isAdminOrDesigner()
}
```

---

## ๐ ุงูุฃูุงู

### โ ุชู ุชุทุจููู:
- [x] ุชุดููุฑ ูููุงุช ุงููุฑูุฑ (Firebase)
- [x] ุญูุงูุฉ ุงููุณุงุฑุงุช ูู Frontend
- [x] Firestore Security Rules
- [x] ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ ูู Backend
- [x] ุญูุธ session ุชููุงุฆูุงู

### ๐ ููุตู ุจู:
- [ ] ุชุบููุฑ ูููุงุช ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ
- [ ] ุชูุนูู 2FA ูููุฏุฑุงุก
- [ ] ูุฑุงุฌุนุฉ Firestore Rules ุฏูุฑูุงู
- [ ] ุฅุถุงูุฉ Activity Logging
- [ ] ุชูุนูู Email Verification

---

## ๐๏ธ Firestore Collections

### users
```json
{
  "uid": "string",
  "email": "string",
  "role": "admin | designer | user",
  "displayName": "string",
  "createdAt": "timestamp"
}
```

---

## ๐ ูุงุฌูุฉ ุงูุงุณุชุฎุฏุงู (APIs)

### useAuth Hook
```tsx
const {
  currentUser,        // User object ูู Firebase
  userData,          // ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
  loading,           // ุญุงูุฉ ุงูุชุญููู
  login,            // ุฏุงูุฉ ุชุณุฌูู ุงูุฏุฎูู
  logout,           // ุฏุงูุฉ ุชุณุฌูู ุงูุฎุฑูุฌ
  register,         // ุฏุงูุฉ ุงูุชุณุฌูู
  hasRole          // ุงูุชุญูู ูู ุงูุฏูุฑ
} = useAuth();
```

### ุฃูุซูุฉ:
```tsx
// ุชุณุฌูู ุฏุฎูู
await login('admin@example.com', 'admin123');

// ุชุณุฌูู ุฎุฑูุฌ
await logout();

// ุงูุชุญูู ูู ุฏูุฑ
if (hasRole('admin')) {
  // ููุฏ ุฎุงุต ุจุงููุฏูุฑ
}

// ุงูุชุญูู ูู ุนุฏุฉ ุฃุฏูุงุฑ
if (hasRole(['admin', 'designer'])) {
  // ููุฏ ูููุฏูุฑ ูุงููุตูู
}
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ูุณุฌู"
**ุงูุญู:** ุฃุถู ุงููุณุชุฎุฏู ูู Firebase Authentication

### โ "ุบูุฑ ูุตุฑุญ ูู ุจุงููุตูู"
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุถุงูุฉ document ุงููุณุชุฎุฏู ูู `users` collection

### โ "Permission denied" ูู Firestore
**ุงูุญู:** ุงูุดุฑ Rules ุงูุฌุฏูุฏุฉ: `firebase deploy --only firestore:rules`

### โ ุตูุญุฉ ุจูุถุงุก
**ุงูุญู:** ุงูุชุญ Console (F12) ูุชุญูู ูู ุงูุฃุฎุทุงุก

---

## ๐๏ธ ุงูุชูุธูู ุจุนุฏ ุงูุฅุนุฏุงุฏ

ุจุนุฏ ุฅูุดุงุก ุงููุณุชุฎุฏููู ุจูุฌุงุญุ ุงุญุฐู:

```bash
# ุงููููุงุช ุงููุคูุชุฉ
rm src/pages/Setup/InitialSetup.tsx
rm src/utils/createInitialUsers.ts
rm -rf src/pages/Setup/
```

ุซู ูู `src/App.tsx` ุงุญุฐู:
```tsx
// ุงุญุฐู ูุฐู ุงูุฃุณุทุฑ:
import InitialSetup from './pages/Setup/InitialSetup';
<Route path="/setup" element={<InitialSetup />} />
```

---

## ๐ ุงููุณุงุนุฏุฉ

ูููุฒูุฏ ูู ุงูุชูุงุตูู:
- **ุฏููู ุดุงูู:** `AUTHENTICATION_GUIDE.md`
- **ุจุฏุก ุณุฑูุน:** `QUICK_START_AUTH.md`
- **Firebase Docs:** https://firebase.google.com/docs/auth
- **Firestore Rules:** https://firebase.google.com/docs/firestore/security/get-started

---

## โ Checklist

### ุงูุฅุนุฏุงุฏ ุงูุฃููู:
- [ ] ุฅูุดุงุก ุงููุณุชุฎุฏููู ูู Firebase
- [ ] ุฅุถุงูุฉ documents ูู Firestore
- [ ] ูุดุฑ Firestore Rules
- [ ] ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุญุฐู ุตูุญุฉ Setup

### ุงูุฃูุงู:
- [ ] ุชุบููุฑ ูููุงุช ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ
- [ ] ูุฑุงุฌุนุฉ Firestore Rules
- [ ] ุชูุนูู 2FA ูููุฏุฑุงุก
- [ ] ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช

### ุงูุฅูุชุงุฌ:
- [ ] ุฅุฒุงูุฉ ุงููููุงุช ุงููุคูุชุฉ
- [ ] ุฅุฒุงูุฉ route /setup
- [ ] ุงุฎุชุจุงุฑ ุฌููุน ุงูุตูุญุงุช
- [ ] ูุฑุงุฌุนุฉ Console ููุฃุฎุทุงุก

---

**ุชู ุจูุฌุงุญ! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ๐**

